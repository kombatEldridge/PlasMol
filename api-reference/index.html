<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>API Reference - PlasMol Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "API Reference";
        var mkdocs_page_input_path = "api-reference.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> PlasMol Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../installation/">Installation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../usage/">Usage</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../tutorials/">Tutorials</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">API Reference</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#directory-tree">Directory Tree</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#quantum">quantum/</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#moleculepy">molecule.py</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#electric_fieldpy">electric_field.py</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#quantumpropagators">quantum/propagators/</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#steppy">step.py</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#rk4py">rk4.py</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#magnus2py">magnus2.py</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#classical">classical/</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#simulationpy">simulation.py</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#sourcespy">sources.py</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#drivers">drivers/</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#classicalpy">classical.py</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#quantumpy">quantum.py</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#plasmolpy">plasmol.py</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#utils">utils/</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../contributing/">Contributing</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../about/">About</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">PlasMol Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">API Reference</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="api-reference">API Reference</h1>
<p>This page documents key classes and methods.</p>
<h2 id="directory-tree">Directory Tree</h2>
<div class="highlight"><pre><span></span><code>|
|_ docs
|  |_ *files for these docs*
|  
|_ src
|  |_ __init__.py
|  |_ constants.py
|  |_ main.py
|  |
|  |_ classical
|  |  |_ __init__.py
|  |  |_ simulation.py
|  |  |_ sources.py
|  |
|  |_ drivers
|  |  |_ __init__.py
|  |  |_ classical.py
|  |  |_ plasmol.py
|  |  |_ quantum.py
|  |
|  |_ input
|  |  |_ __init__.py
|  |  |_ cli.py
|  |  |_ params.py
|  |  |_ parser.py
|  |
|  |_ quantum
|  |  |_ __init__.py
|  |  |_ chkfile.py
|  |  |_ electric_field.py
|  |  |_ molecule.py
|  |  |_ propagation.py
|  |  |
|  |  |_ propagators
|  |     |_ __init__.py
|  |     |_ magnus2.py
|  |     |_ rk4.py
|  |     |_ step.py
|  |
|  |_ utils
|  |  |_ __init__.py
|  |  |_ csv.py
|  |   |_ fourier.py
|  |   |_ gif.py
|  |   |_ logging.py
|  |   |_ plotting.py
|
|_ templates
   |_ template-classical.in
   |_ template-plasmol.in
   |_ template-quantum.in
</code></pre></div>
<h2 id="quantum">quantum/</h2>
<h3 id="moleculepy"><code>molecule.py</code></h3>
<ul>
<li>Initializes molecule with PySCF, handles SCF, Fock matrix, dipole calculations.</li>
<li>Additional methods can be injected at the bottom of this class to track other quantum properties. For example, we track the induced dipole using the <code>calculate_mu()</code> method and then inject the call to this method in the <code>quantum/propagation.py</code> file.</li>
</ul>
<h3 id="electric_fieldpy"><code>electric_field.py</code></h3>
<ul>
<li>Builds electric fields (pulse or kick shapes) for the molecule to feel <em>only</em> when a quantum simulation is chosen. If classical or full PlasMol simulation is running, the electric field is generated inside the Meep simulation (using <code>classical/sources.py</code>).</li>
<li>Other electric field shapes for quantum simulations can be added to the <code>build_field()</code> method using the other two shapes as templates.</li>
</ul>
<h2 id="quantumpropagators">quantum/propagators/</h2>
<h3 id="steppy"><code>step.py</code></h3>
<ul>
<li>Propagates molecular orbitals using the Magnus step method.</li>
<li>This method is also known as the modified midpoint unitary transformation (MMUT) scheme from <a href="https://doi.org/10.1039/B415849K">https://doi.org/10.1039/B415849K</a></li>
</ul>
<div class="arithmatex">\[
    \begin{gathered}
    \mathbf{F}_{\text {orth }}=\text {molecule.get_F_orth}\left( \mathbf{D}_{\text {AO }}, \vec{\mathbf{E}}\right)\\
    \mathbf{U} =\exp \left(-2 i \Delta t \cdot \mathbf{F}_{\text {orth}} (t)\right)\\
    \mathbf{C}_{\text{ortho}} \left(t + \Delta t\right)= \mathbf{U} \mathbf{C}_{\text{ortho}} \left(t - \Delta t\right)
    \end{gathered}
\]</div>
<h3 id="rk4py"><code>rk4.py</code></h3>
<ul>
<li>Propagates molecular orbitals using the Runge-Kutta 4 method.</li>
</ul>
<div class="arithmatex">\[
    \begin{gathered}
    \mathbf{F}_{\text {orth }}=\text {molecule.get_F_orth}\left( \mathbf{D}_{\text {AO }}, \vec{\mathbf{E}}\right)\\
    k _1=-i \Delta t \cdot \mathbf{F}_{\text {orth }} \mathbf{C}_{\text {orth }} \\
    \mathbf{C}_{\text {orth, } 1}= \mathbf{C}_{\text {orth }}+\frac{1}{2} k _1 \\
    k _2=-i \Delta t \cdot \mathbf{F}_{\text {orth }} \mathbf{C}_{\text {orth, } 1} \\
    \mathbf{C}_{\text {orth, } 2}= \mathbf{C}_{\text {orth }}+\frac{1}{2} k _2 \\
    k _3=-i \Delta t \cdot \mathbf{F}_{\text {orth }} \mathbf{C}_{\text {orth, } 2} \\
    \mathbf{C}_{\text {orth, } 3}= \mathbf{C}_{\text {orth }}+ k _3 \\
    k _4=-i \Delta t \cdot \mathbf{F}_{\text {orth }} \mathbf{C}_{\text {orth, } 3} \\
    \mathbf{C}_{\text {orth }}(t+\Delta t)= \mathbf{C}_{\text {orth }}+\frac{ k _1}{6}+\frac{ k _2}{3}+\frac{ k _3}{3}+\frac{ k _4}{6}
    \end{gathered}
\]</div>
<h3 id="magnus2py"><code>magnus2.py</code></h3>
<ul>
<li>Propagates molecular orbitals using the second order Magnus method with a predictor-corrector algorithm included.</li>
<li>This method is described in many RT-TDDFT papers, but I found the derivation from <a href="https://doi.org/10.1021/ct501078d">https://doi.org/10.1021/ct501078d</a> to be very understandable.</li>
</ul>
<div class="arithmatex">\[
    \mathbf{F}_{\text{orth }}^{(0)}(t+\Delta t / 2)=2 \mathbf{F}_{\text{orth }}(t)- \mathbf{F}_{\text{orth }}(t-\Delta t / 2)
\]</div>
<ul>
<li>Then, for iterations <span class="arithmatex">\(k=0,1,2, \ldots\)</span> until convergence or maximum iterations exceeded:</li>
</ul>
<div class="arithmatex">\[
    \begin{gathered}
    \mathbf{U}^{(k)}=\exp \left(-i \Delta t \cdot \mathbf{F}_{\text {orth }}^{(k)}(t+\Delta t / 2)\right) \\
    \mathbf{C}_{\text {orth }}^{(k+1)}(t+\Delta t)= \mathbf{U}^{(k)} \mathbf{C}_{\text {orth }}(t) \\
    \mathbf{C}^{(k+1)}(t+\Delta t)=\text {molecule.rotate_coeff_away_from_orth}\left( \mathbf{C}_{\text {orth }}^{(k+1)}(t+\Delta t)\right) \\
    \mathbf{D}_{\text {AO }}^{(k+1)}(t+\Delta t)=\text {molecule.make_rdm1}\left( \mathbf{C}^{(k+1)}(t+\Delta t), \text { occ }\right) \\
    \mathbf{F}_{\text {orth }}^{(k+1)}(t+\Delta t)=\text {molecule.get_F_orth}\left( \mathbf{D}_{\text {AO }}^{(k+1)}(t+\Delta t), \vec{\mathbf{E}}\right)
    \end{gathered}
\]</div>
<ul>
<li>Update the midpoint guess for the next iteration:</li>
</ul>
<div class="arithmatex">\[
    \mathbf{F}_{\text {orth }}^{(k+1)}(t+\Delta t / 2)=\frac{1}{2}\left( \mathbf{F}_{\text {orth }}(t)+ \mathbf{F}_{\text {orth }}^{(k+1)}(t+\Delta t)\right)
\]</div>
<ul>
<li>Convergence is checked starting from the second iteration (<span class="arithmatex">\(k \geq 1\)</span>) as:</li>
</ul>
<div class="arithmatex">\[
    \left\| \mathbf{C}^{(k+1)}(t+\Delta t)- \mathbf{C}^{(k)}(t+\Delta t)\right\|&lt;\epsilon
\]</div>
<ul>
<li>where <span class="arithmatex">\(\epsilon=\)</span> <code>params.pc_convergence</code>. Upon convergence, assign the final values to the molecule object:</li>
</ul>
<div class="arithmatex">\[
    \begin{gathered}
    \mathbf{C}(t+\Delta t)= \mathbf{C}^{(\text {final})}(t+\Delta t), \quad \mathbf{D} _{\text{AO}}(t+\Delta t)= \mathbf{D} _{\text{AO}}^{(\text {final})}(t+\Delta t) \\
    \mathbf{F}_{\text {orth }}(t+\Delta t)= \mathbf{F}_{\text {orth }}^{(\text {final})}(t+\Delta t), \quad \mathbf{F}_{\text {orth }}(t+\Delta t / 2)= \mathbf{F}_{\text {orth }}^{(\text {final})}(t+\Delta t / 2)
    \end{gathered}
\]</div>
<p>The updated <span class="arithmatex">\(\mathbf{F}_{\text{orth }}(t+\Delta t / 2)\)</span> is stored for extrapolation in the next time step.</p>
<h2 id="classical">classical/</h2>
<h3 id="simulationpy"><code>simulation.py</code></h3>
<ul>
<li>Runs Meep and full PlasMol simulation, handles sources, PML, symmetries.</li>
<li>For those who want to add tracking to certain parameters, a commented section can be found in the <code>run()</code> method and right above it.</li>
<li>An example code block is added (but commented out) to the <code>run()</code> method to graph the 3D model of the NP.</li>
</ul>
<h3 id="sourcespy"><code>sources.py</code></h3>
<ul>
<li>
<p>Currently supports </p>
<ul>
<li><code>ContinuousSource</code><ul>
<li>The <code>ContinuousSource</code> provides a continuous-wave electromagnetic source with constant frequency and amplitude that activates abruptly at the start time and persists until the optional end time.
$$
    s(t)=\theta\left(t-t_{\text {start}}\right) \exp (-i \omega t)
$$</li>
<li>where <span class="arithmatex">\(\theta\)</span> is the Heaviside step function, <span class="arithmatex">\(t_{\text {start}}\)</span> is the start time (default 0 ), and <span class="arithmatex">\(\omega=2 \pi f\)</span> with <span class="arithmatex">\(f\)</span> being the specified frequency.</li>
</ul>
</li>
<li><code>GaussianSource</code><ul>
<li>The <code>GaussianSource</code> generates a pulsed electromagnetic source with a Gaussian temporal envelope modulating a carrier wave, designed for broadband frequency excitation while minimizing truncation effects through a shifted peak.
$$ 
    s(t)=\exp \left(-\frac{\left(t-t_0\right)^2}{2 w^2}\right) \exp (-i \omega t)
$$</li>
<li>where <span class="arithmatex">\(w\)</span> is the width parameter, <span class="arithmatex">\(t_0=t_{\text {start}}+c \cdot w\)</span> with <span class="arithmatex">\(c\)</span> being the cutoff (default 5.0) to shift the peak and avoid abrupt truncation at <span class="arithmatex">\(t=t_{\text {start}}\)</span>, and <span class="arithmatex">\(\omega=2 \pi f\)</span> with <span class="arithmatex">\(f\)</span> being the center frequency.</li>
</ul>
</li>
<li><code>ChirpedSource</code><ul>
<li>The <code>ChirpedSource</code> is a custom pulsed source featuring a Gaussian envelope with an added quadratic phase term to produce a linearly chirped frequency sweep, useful for applications requiring timevarying frequency content.
$$
    s(t)=\exp \left(i 2 \pi f\left(t-t_p\right)\right) \exp \left(-a\left(t-t_p\right)^2+i b\left(t-t_p\right)^2\right)
$$</li>
<li>where <span class="arithmatex">\(f\)</span> is the base frequency, <span class="arithmatex">\(t_p\)</span> is the peak time, <span class="arithmatex">\(a\)</span> is the width parameter controlling the envelope decay, and <span class="arithmatex">\(b\)</span> is the chirp rate introducing quadratic phase for frequency modulation.</li>
</ul>
</li>
<li><code>PulseSource</code><ul>
<li>When simulating an absorption spectrum, this source is required.</li>
<li>The <code>PulseSource</code> creates a custom Gaussian-enveloped pulse with a sinusoidal carrier wave peaked at a specified time, suitable for simulating short electromagnetic bursts in time-domain simulations.
$$
    s(t)=\exp \left(i 2 \pi f\left(t-t_p\right)\right) \exp \left(-a\left(t-t_p\right)^2\right)
$$</li>
<li>where <span class="arithmatex">\(f\)</span> is the carrier frequency, <span class="arithmatex">\(t_p\)</span> is the peak time, and <span class="arithmatex">\(a\)</span> is the width parameter determining the pulse duration.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Other electric field shapes for quantum simulations can be supported using the other two shapes as templates, but additional options for the sources will need to be added to the input file parser in the <code>input/params.py</code> file under the <code>getSource()</code> method (found in the <code>buildclassicalParams()</code> method).</p>
</li>
</ul>
<h2 id="drivers">drivers/</h2>
<h3 id="classicalpy"><code>classical.py</code></h3>
<ul>
<li>Runs Meep simulation.</li>
</ul>
<h3 id="quantumpy"><code>quantum.py</code></h3>
<ul>
<li>Runs RT-TDDFT, supports multi-threading for transforms.</li>
</ul>
<h3 id="plasmolpy"><code>plasmol.py</code></h3>
<ul>
<li>Hybrid run.</li>
</ul>
<h2 id="utils">utils/</h2>
<ul>
<li><code>utils.csv.initCSV(filename, comment)</code>, <code>updateCSV(...)</code>.</li>
<li><code>utils.plotting.show_eField_pField(eFieldFile, pFieldFile)</code>.</li>
<li><code>utils.fourier.transform(...)</code>: Fourier transform and absorption spectrum.</li>
</ul>
<p>[TODO: Add full parameter lists, return types, or use Sphinx for auto-gen docs.]</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../tutorials/" class="btn btn-neutral float-left" title="Tutorials"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../contributing/" class="btn btn-neutral float-right" title="Contributing">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../tutorials/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../contributing/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
